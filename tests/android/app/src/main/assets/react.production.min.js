// Minimal React shim for Phase 1
// Full React.js (~40KB min+gzip) would be bundled in production
// This is a stub to make the system compile and run

globalThis.React = {
    createElement: function (type, props, ...children) {
        return {
            $$typeof: Symbol.for('react.element'),
            type: type,
            key: null,
            ref: null,
            props: {
                ...(props || {}),
                children: children.length === 1 ? children[0] : children
            },
            _owner: null
        };
    },

    Fragment: Symbol.for('react.fragment'),

    useState: function (initialValue) {
        let state = initialValue;
        const setState = function (newValue) {
            state = typeof newValue === 'function' ? newValue(state) : newValue;
        };
        return [state, setState];
    },

    useEffect: function (callback, deps) {
        // No-op for now
    },

    useRef: function (initialValue) {
        return { current: initialValue };
    },

    useCallback: function (callback, deps) {
        return callback;
    },

    useMemo: function (callback, deps) {
        return callback();
    },

    useContext: function (context) {
        return context._currentValue;
    },

    createContext: function (defaultValue) {
        return {
            _currentValue: defaultValue,
            Provider: { type: 'Context.Provider' },
            Consumer: { type: 'Context.Consumer' }
        };
    },

    Children: {
        map: function (children, fn) {
            if (Array.isArray(children)) return children.map(fn);
            return [fn(children, 0)];
        },
        forEach: function (children, fn) {
            if (Array.isArray(children)) children.forEach(fn);
            else fn(children, 0);
        },
        count: function (children) {
            return Array.isArray(children) ? children.length : 1;
        },
        only: function (children) {
            if (Array.isArray(children) && children.length === 1) return children[0];
            return children;
        }
    }
};

globalThis.ReactDOM = {
    createRoot: function (container) {
        return {
            render: function (element) { }
        };
    },

    render: function (element, container) {
        // No-op for now
    }
};

console.log('React shim loaded');
